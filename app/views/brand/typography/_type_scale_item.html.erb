<tr class="border-b border-gray-200 hover:bg-gray-50" id="type-scale-item-<%= index %>">
  <% if f %>
    <%= f.fields_for :type_scale, scale, index: index do |scale_form| %>
      <td class="px-4 py-3">
        <span style="font-family: '<%= typeface.name %>', sans-serif; font-size: <%= scale.font_size || "" %>; line-height: <%= scale.line_height || "" %>; font-weight: <%= scale.font_weight || "400" %>;">
          Sample Text
        </span>
      </td>
      <td class="px-4 py-3">
        <%= scale_form.text_field :font_size, 
            class: "w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-black focus:border-transparent",
            data: { action: "input->autosave#save" } %>
      </td>
      <td class="px-4 py-3">
        <%= scale_form.text_field :line_height, 
            class: "w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-black focus:border-transparent",
            data: { action: "input->autosave#save" } %>
      </td>
      <td class="px-4 py-3">
        <%= scale_form.select :variant, 
            options_for_select([
              ["Regular", "Regular"],
              ["Bold", "Bold"],
              ["Medium", "Medium"],
              ["Thin", "Thin"],
              ["Light", "Light"],
              ["SemiBold", "SemiBold"],
              ["ExtraBold", "ExtraBold"],
              ["Black", "Black"],
              ["Italic", "Italic"]
            ], scale.variant),
            {},
            { class: "w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-black focus:border-transparent",
              data: { action: "change->autosave#save" } } %>
      </td>
      <td class="px-4 py-3">
        <% 
          # Extract available weights from variants
          weights = (typeface.variants || []).map { |v| v.to_s.gsub(/italic$/i, "") }.select { |v| v.match(/^\d+$/) }.uniq.sort_by(&:to_i)
          weights = ["100", "300", "400", "500", "600", "700", "800", "900"] if weights.empty?
          
          weight_options = weights.map do |w|
            label = case w
            when "100" then "100 (Thin)"
            when "200" then "200 (Extra Light)"
            when "300" then "300 (Light)"
            when "400" then "400 (Regular)"
            when "500" then "500 (Medium)"
            when "600" then "600 (Semi Bold)"
            when "700" then "700 (Bold)"
            when "800" then "800 (Extra Bold)"
            when "900" then "900 (Black)"
            else w
            end
            [label, w]
          end
        %>
        <%= scale_form.select :font_weight, 
            options_for_select(weight_options, scale.font_weight || "400"),
            {},
            { class: "w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-black focus:border-transparent",
              data: { action: "change->autosave#save" } } %>
      </td>
      <td class="px-4 py-3">
        <%= link_to remove_type_scale_item_brand_typography_path(@brand, typeface_id: typeface.id, index: index),
            method: :delete,
            data: { turbo: true, turbo_stream: true, turbo_confirm: "Remove this scale item?" },
            class: "text-gray-400 hover:text-red-500 transition-colors" do %>
          <i class="fa-solid fa-times"></i>
        <% end %>
      </td>
    <% end %>
  <% else %>
    <%# Fallback for Turbo Stream appends - use standalone form helpers %>
    <td class="px-4 py-3">
      <span style="font-family: '<%= typeface.name %>', sans-serif; font-size: <%= scale.font_size || "" %>; line-height: <%= scale.line_height || "" %>; font-weight: <%= scale.font_weight || "400" %>;">
        Sample Text
      </span>
    </td>
    <td class="px-4 py-3">
      <%= text_field_tag "typeface[type_scale][#{index}][font_size]", scale.font_size, 
          class: "w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-black focus:border-transparent",
          data: { action: "input->autosave#save" } %>
    </td>
    <td class="px-4 py-3">
      <%= text_field_tag "typeface[type_scale][#{index}][line_height]", scale.line_height, 
          class: "w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-black focus:border-transparent",
          data: { action: "input->autosave#save" } %>
    </td>
    <td class="px-4 py-3">
      <%= select_tag "typeface[type_scale][#{index}][variant]", 
          options_for_select([
            ["Regular", "Regular"],
            ["Bold", "Bold"],
            ["Medium", "Medium"],
            ["Thin", "Thin"],
            ["Light", "Light"],
            ["SemiBold", "SemiBold"],
            ["ExtraBold", "ExtraBold"],
            ["Black", "Black"],
            ["Italic", "Italic"]
          ], scale.variant),
          { class: "w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-black focus:border-transparent",
            data: { action: "change->autosave#save" } } %>
    </td>
    <td class="px-4 py-3">
      <% 
        # Extract available weights from variants
        weights = (typeface.variants || []).map { |v| v.to_s.gsub(/italic$/i, "") }.select { |v| v.match(/^\d+$/) }.uniq.sort_by(&:to_i)
        weights = ["100", "300", "400", "500", "600", "700", "800", "900"] if weights.empty?
        
        weight_options = weights.map do |w|
          label = case w
          when "100" then "100 (Thin)"
          when "200" then "200 (Extra Light)"
          when "300" then "300 (Light)"
          when "400" then "400 (Regular)"
          when "500" then "500 (Medium)"
          when "600" then "600 (Semi Bold)"
          when "700" then "700 (Bold)"
          when "800" then "800 (Extra Bold)"
          when "900" then "900 (Black)"
          else w
          end
          [label, w]
        end
      %>
      <%= select_tag "typeface[type_scale][#{index}][font_weight]", 
          options_for_select(weight_options, scale.font_weight || "400"),
          { class: "w-full px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-black focus:border-transparent",
            data: { action: "change->autosave#save" } } %>
    </td>
    <td class="px-4 py-3">
      <%= link_to remove_type_scale_item_brand_typography_path(@brand, typeface_id: typeface.id, index: index),
          method: :delete,
          data: { turbo: true, turbo_stream: true, turbo_confirm: "Remove this scale item?" },
          class: "text-gray-400 hover:text-red-500 transition-colors" do %>
        <i class="fa-solid fa-times"></i>
      <% end %>
    </td>
  <% end %>
</tr>

