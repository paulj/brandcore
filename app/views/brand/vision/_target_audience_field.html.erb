<div id="target_audience_field">
  <%= form_with model: brand_vision, url: brand_vision_path(brand), method: :patch, data: { turbo: true, controller: "autosave", autosave_target: "form" } do |f| %>
    <div class="space-y-4">
      <div class="space-y-2" data-controller="tag-input" data-tag-input-field-name-value="brand_vision[audiences][]">
        <input type="text"
               data-tag-input-target="input"
               data-action="keydown.enter->tag-input#addTag:prevent"
               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent"
               placeholder="Type an audience segment (e.g., small business owners, millennials) and press Enter...">
        <div id="audiences-container" class="flex flex-wrap gap-2" data-tag-input-target="container">
          <% audiences = brand_vision.audiences || [] %>
          <% audiences.each do |audience| %>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-800">
              <%= audience %>
              <button type="button" class="ml-2 text-gray-500 hover:text-gray-700" data-action="click->tag-input#removeTag">Ã—</button>
            </span>
          <% end %>
        </div>
        <% audiences.each_with_index do |audience, index| %>
          <%= f.hidden_field "audiences[]", value: audience, data: { tag_input_target: "hiddenField" } %>
        <% end %>
      </div>

      <!-- Suggestions container (replaced via Turbo Streams) -->
      <div id="target_audience_suggestions"></div>
    </div>
  <% end %>
</div>
